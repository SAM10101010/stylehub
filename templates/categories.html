<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StyleHub - Category Products</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <header>
        <div class="logo">StyleHub</div>
        <a href="/" class="back-home">üè† Back to Home</a>
        <button id="cart-btn" onclick="goToCart()">üõí Cart (<span id="cart-count">0</span>)</button>

        
        
    </header>

    <section class="categories-section">
        <h2>Select a Category</h2>
        <div class="category-buttons">
            <button onclick="filterProducts(1)">Jeans</button>
            <button onclick="filterProducts(2)">Dresses</button>
            <button onclick="filterProducts(3)">T-Shirts</button>
            <button onclick="filterProducts(4)">Outerwear</button>
            <button onclick="filterProducts(5)">Accessories</button>
        </div>
    </section>

    <h1 id="category-title">Category Products</h1>
    <section id="product-list" class="grid"></section>

    <footer>
        <p>&copy; 2025 StyleHub. All rights reserved.</p>
    </footer>
    <script>
        let cart = [];

        // Function to get query parameters
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Mapping of category IDs to category names
        const categories = {
            1: "Jeans",
            2: "Dresses",
            3: "T-Shirts",
            4: "Outerwear",
            5: "Accessories"
        };

        // Fetch and display products based on category ID
        async function fetchProducts(categoryId) {
            const categoryTitle = document.getElementById("category-title");

            if (categoryId !== "all") {
                categoryId = parseInt(categoryId);
            }

            if (categoryId === "all") {
                categoryTitle.innerText = "All Products";
            } else if (categories[categoryId]) {
                categoryTitle.innerText = `${categories[categoryId]} Products`;
            } else {
                categoryTitle.innerText = "Please select a category";
                return;
            }

            try {
                const url = categoryId === "all" ? "/products" : `/products?category_id=${categoryId}`;
                const response = await fetch(url);
                const products = await response.json();
                const productList = document.getElementById("product-list");
                productList.innerHTML = "";

                if (products.length === 0) {
                    productList.innerHTML = "<p>No products available for this category.</p>";
                    return;
                }

                products.forEach(product => {
                    const productCard = document.createElement("div");
                    productCard.classList.add("product-card");
                    productCard.innerHTML = `
                        <img src="${product.image_url || product.photo}" alt="${product.name}">
                        <h3>${product.name}</h3>
                        <p>Price: $${product.price}</p>
                        <button onclick="buyProduct(${parseInt(product.id)})">üõí Buy Now</button>
                        <button onclick="addToCart(${parseInt(product.id)}, '${product.name}', ${product.price})">üõçÔ∏è Add to Cart</button>
                    `;
                    productList.appendChild(productCard);
                });
            } catch (error) {
                console.error("Error fetching products:", error);
            }
        }

        // Function to simulate buying a product
        function buyProduct(productId) {
            alert(`Product with ID ${productId} has been bought!`);
        }

        // Function to add product to cart
        function addToCart(productId, productName, productPrice) {
            cart.push({ id: productId, name: productName, price: productPrice });
            updateCartCount();
            alert(`${productName} added to cart!`);
        }
        // Function to navigate to the cart page with cart data
        function goToCart() {
            localStorage.setItem("cart", JSON.stringify(cart)); // Store cart in localStorage
            window.location.href = "/cart.html"; // Redirect to the cart page
        }

        


        // Function to update cart count
        function updateCartCount() {
            const cartCount = document.getElementById("cart-count");
            if (cartCount) {
                cartCount.innerText = cart.length;
            }
        }

        // Function to view cart items
        function viewCart() {
            if (cart.length === 0) {
                alert("Your cart is empty.");
                return;
            }

            let cartDetails = "üõí Your Cart:\n";
            cart.forEach(item => {
                cartDetails += `üî∏ ${item.name} - $${item.price}\n`;
            });
            alert(cartDetails);
        }

        // Filter products by category
        function filterProducts(categoryId) {
            fetchProducts(categoryId);
        }

        // Load products based on query parameter on page load
        document.addEventListener("DOMContentLoaded", () => {
            const categoryId = getQueryParam("category_id") || "all";
            fetchProducts(categoryId);
        });
    </script>
    <script>
        async function fetchProducts(categoryId = "all", searchQuery = "") {
            const categoryTitle = document.getElementById("category-title");
    
            // Display category or search title
            if (searchQuery) {
                categoryTitle.innerText = `Search Results for "${searchQuery}"`;
            } else if (categoryId === "all") {
                categoryTitle.innerText = "All Products";
            } else if (categories[categoryId]) {
                categoryTitle.innerText = `${categories[categoryId]} Products`;
            } else {
                categoryTitle.innerText = "Please select a category";
                return;
            }
    
            try {
                let url = "/products";
                if (searchQuery) {
                    url += `?search=${encodeURIComponent(searchQuery)}`;
                } else if (categoryId !== "all") {
                    url += `?category_id=${categoryId}`;
                }
    
                const response = await fetch(url);
                const products = await response.json();
                const productList = document.getElementById("product-list");
                productList.innerHTML = "";
    
                if (products.length === 0) {
                    productList.innerHTML = "<p>No products found.</p>";
                    return;
                }
    
                products.forEach(product => {
                    const productCard = document.createElement("div");
                    productCard.classList.add("product-card");
                    productCard.innerHTML = `
                        <img src="${product.image_url || product.photo}" alt="${product.name}">
                        <h3>${product.name}</h3>
                        <p>Price: $${product.price}</p>
                        <button onclick="buyProduct(${product.id})">üõí Buy Now</button>
                        <button onclick="addToCart(${product.id}, '${product.name}', ${product.price})">üõçÔ∏è Add to Cart</button>
                    `;
                    productList.appendChild(productCard);
                });
            } catch (error) {
                console.error("Error fetching products:", error);
            }
        }
    
        // Check for search query on page load
        document.addEventListener("DOMContentLoaded", () => {
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get("search");
            const categoryId = urlParams.get("category_id") || "all";
    
            if (searchQuery) {
                fetchProducts("all", searchQuery);
            } else {
                fetchProducts(categoryId);
            }
        });
    </script>
    
</body>
</html>
